name: ✅ CI Básico para CollectionView

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  build-and-test:
    runs-on: macos-latest
    timeout-minutes: 8

    steps:
    - uses: actions/checkout@v4

    - name: Configurar Xcode
      run: |
        sudo xcode-select -switch /Applications/Xcode_16.2.app/Contents/Developer
        sudo xcodebuild -runFirstLaunch

    - name: Build e Teste
      run: |
        set -o pipefail && xcodebuild \
        -project "testecollectionview.xcodeproj" \
        -scheme "testecollectionview" \
        -destination "platform=iOS Simulator,name=iPhone 16" \
        CODE_SIGNING_ALLOWED=NO \
        build test | tee test-results.txt

    - name: Publicar Resultados
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: test-results
        path: |
          test-results.txt
          ~/Library/Developer/Xcode/DerivedData/**/Logs/Test/*.xcresult
